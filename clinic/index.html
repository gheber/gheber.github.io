<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-03-02 Tue 13:32 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Call the Doctor - HDF(5) Clinic</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="gerdheber" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Call the Doctor - HDF(5) Clinic</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org2dab1cf">Clinic 2021-03-02</a>
<ul>
<li><a href="#org8c45316">Your questions</a></li>
<li><a href="#org8107d57">Last week's highlights</a></li>
</ul>
</li>
<li><a href="#org2e9ffbd">Clinic 2021-02-23</a>
<ul>
<li><a href="#org61e8221">Your questions</a></li>
<li><a href="#org89f253b">Last week's highlights</a></li>
<li><a href="#org17bbc8f">Appendix</a></li>
</ul>
</li>
<li><a href="#orgdce8002">Clinic 2021-02-16</a>
<ul>
<li><a href="#org55af126">Your questions</a></li>
<li><a href="#org21740da">Last week's highlights</a></li>
<li><a href="#org939a8bb">Notes</a></li>
</ul>
</li>
<li><a href="#orgb940ca9">Clinic 2021-02-09</a>
<ul>
<li><a href="#org23ceace">Goal(s)</a></li>
<li><a href="#orgcff77fb">This is a meeting dedicated to <i>your</i> questions.</a></li>
<li><a href="#orgaeaa3a2">In the unlikely event there aren't any</a></li>
<li><a href="#orgd7b1f27">Sometimes life deals you an HDF5 file</a></li>
<li><a href="#orgd90e9a7">Meeting Etiquette</a></li>
<li><a href="#orgb49a30a">Be social, turn on your camera (if you've got one)</a></li>
<li><a href="#org8fb40ee">Raise your hand to signal a contribution (question, comment)</a></li>
<li><a href="#org6fc31e4">Be mindful of your "airtime"</a></li>
<li><a href="#org579c9d2">Introduce yourself</a></li>
<li><a href="#org54d360b">Use the shared Google doc for questions and code snippets</a></li>
<li><a href="#orgd2fd193">When the 30 min. timer runs out, this meeting is over.</a></li>
<li><a href="#org06af423">Notes</a></li>
<li><a href="#org1865d2e">Don't miss our next webinar about data virtualization with HDF5-UDF and how it can streamline your work</a></li>
<li><a href="#orgc741995">Bug-of-the-Week Award (my candidate)</a></li>
<li><a href="#org3427e43">Documentation update</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org2dab1cf" class="outline-2">
<h2 id="org2dab1cf">Clinic 2021-03-02</h2>
<div class="outline-text-2" id="text-org2dab1cf">
</div>
<div id="outline-container-org8c45316" class="outline-3">
<h3 id="org8c45316">Your questions</h3>
<div class="outline-text-3" id="text-org8c45316">
</div>
<ul class="org-ul">
<li><a id="org33bb2f1"></a><a href="https://github.com/steven-varga/h5rnd">h5rnd</a><br />
<div class="outline-text-4" id="text-org33bb2f1">
<ul class="org-ul">
<li><b><b>Question:</b></b> How are generated HDF5 objects named?  An integer name, or can a
randomized string be used?
<ul class="org-ul">
<li><code>h5rnd</code> Generates a pool of random strings as link names</li>
<li>Uniform length distribution between 5 and 30 over <code>[a-z][A-Z]</code></li>
</ul></li>

<li><b><b>Question:</b></b> Does it create multi-dimensional datasets with a rich set of
HDF5 datatypes?  Compound datatypes, perhaps?
<ul class="org-ul">
<li>Currently, it creates 1,000 element 1D FP64 datasets (w/ attribute)</li>
<li>RE: types - anything is possible. Budget?</li>
</ul></li>

<li><b><b>Question:</b></b> Are named datatypes generated? If not, are these reasonable
types of extensions for <code>h5rnd</code>?
<ul class="org-ul">
<li>Not currently, but anything is possible</li>
</ul></li>
</ul>
</div>
</li>

<li><a id="orgd171883"></a>Other questions?<br />
<div class="outline-text-4" id="text-orgd171883">
<ul class="org-ul">
<li><b><b>Question:</b></b> How do these extensions fit with the general intent and
extensibility of <code>h5rnd</code>?
<ul class="org-ul">
<li>It was written as an illustration</li>
<li>Uses an older version of H5CPP</li>
<li>Labeling could be improved</li>
<li>Dataset generation under development</li>
<li>Some enhancements in a future version</li>
</ul></li>
</ul>
</div>
</li>
</ul>
</div>

<div id="outline-container-org8107d57" class="outline-3">
<h3 id="org8107d57">Last week's highlights</h3>
<div class="outline-text-3" id="text-org8107d57">
</div>
<ul class="org-ul">
<li><a id="org640745e"></a>Forum<br />
<ul class="org-ul">
<li><a id="orgcd83348"></a><a href="https://forum.hdfgroup.org/t/external-link-access-in-parallel-hdf5-1-12-0/8219">External link access in parallel HDF5 1.12.0</a><br />
<div class="outline-text-5" id="text-orgcd83348">
<ul class="org-ul">
<li>Can't access externally linked datasets in parallel; fine in 1.10.x and in serial</li>
<li>It appears that someone encountered a known bug in the field</li>
<li>Dev. claim it's fixed in <code>develop</code>, waiting for confirmation from the user</li>
</ul>
</div>
</li>

<li><a id="org647240f"></a><a href="https://forum.hdfgroup.org/t/h5i-dec-ref-hangs/8104"><code>H5I_dec_ref</code> hangs</a><br />
<div class="outline-text-5" id="text-org647240f">
<ul class="org-ul">
<li><a href="https://portal.hdfgroup.org/display/HDF5/H5I_DEC_REF"><code>H5Idec_ref</code></a> is one of those functions that needs to be used w/ extra care</li>
<li>Using <code>mpi4py</code> and <code>h5py</code></li>
<li>User provided an MWE (in Python) and, honestly, there is limited help we can
offer (as we are neither <code>mpi4py</code> nor <code>h5py</code> experts)</li>
<li>A C or C++ MWE might be the better starting point</li>
</ul>
</div>
</li>

<li><a id="org62ad69a"></a><a href="https://forum.hdfgroup.org/t/h5diff-exits-with-1-but-doesnt-print-differences/6872"><code>h5diff</code> exits with 1 but doesn’t print differences</a><br />
<div class="outline-text-5" id="text-org62ad69a">
<ul class="org-ul">
<li>Case of out-of-date/poor documentation</li>
<li><a href="https://portal.hdfgroup.org/display/HDF5/h5diff"><code>h5diff</code></a> is perhaps the most complex tool (multi-graph comparison + what does
<code>'='</code> mean?)</li>
<li>Writing code is the easy part</li>
<li>We need to do better</li>
</ul>
</div>
</li>

<li><a id="orgeb61f53"></a><a href="https://forum.hdfgroup.org/t/independent-datasets-for-mpi-processes-progress/8202">Independent datasets for MPI processes. Progress?</a><br />
<div class="outline-text-5" id="text-orgeb61f53">
<ul class="org-ul">
<li>Need some clarification on the problem formulation</li>
<li>Current status (w/ MPI) MD-modifying ops. must be collective</li>
<li>On the horizon: asynchronous operations (ASYNC VOL)</li>
</ul>
</div>
</li>

<li><a id="org3db7d42"></a><a href="https://forum.hdfgroup.org/t/writing-to-virtual-datasets/8188">Writing to virtual datasets</a><br />
<div class="outline-text-5" id="text-org3db7d42">
<ul class="org-ul">
<li>Apparently broken when a datatype conversion (truncation!) is involved</li>
</ul>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org2e9ffbd" class="outline-2">
<h2 id="org2e9ffbd">Clinic 2021-02-23</h2>
<div class="outline-text-2" id="text-org2e9ffbd">
</div>
<div id="outline-container-org61e8221" class="outline-3">
<h3 id="org61e8221">Your questions</h3>
<div class="outline-text-3" id="text-org61e8221">
</div>
<ul class="org-ul">
<li><a id="org69a15f1"></a>How to use <code>H5Ocopy</code> in C++ code?<br />
<div class="outline-text-4" id="text-org69a15f1">
<ul class="org-ul">
<li><p>
<a href="https://forum.hdfgroup.org/t/how-to-use-h5copy-in-c-code/8175">Forum post</a>
</p>
<blockquote>
<p>
sandhya.v250 (Feb 19)
</p>

<p>
Hello Team, I want to copy few groups from one hdf5 file to hdf5 another file
which is not yet created and this should be done inside the C++ code..can you
please tell me how can I use this inside this tool
</p>
</blockquote></li>

<li><p>
The <a href="https://portal.hdfgroup.org/display/HDF5/H5O_COPY">function in question</a>  (there is also a tool called <code>h5copy</code>):
</p>
<div class="org-src-container">
<pre class="src src-C">
<span style="color: #6434A3;">herr_t</span> <span style="color: #006699;">H5Ocopy</span>
(
 <span style="color: #6434A3;">hid_t</span>       <span style="color: #BA36A5;">src_loc_id</span>,
 <span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span>* <span style="color: #BA36A5;">src_name</span>,
 <span style="color: #6434A3;">hid_t</span>       <span style="color: #BA36A5;">dst_loc_id</span>,
 <span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span>* <span style="color: #BA36A5;">dst_name</span>,
 <span style="color: #6434A3;">hid_t</span>       <span style="color: #BA36A5;">ocpypl_id</span>,
 <span style="color: #6434A3;">hid_t</span>       <span style="color: #BA36A5;">lcpl_id</span>
);

</pre>
</div></li>

<li>The emphasis  appears to be on C++
<ul class="org-ul">
<li>You can do this in C. It's just more boilerplate.</li>
<li>Whenever I need something C++, I turn to my colleague Steven Varga (=
Mr. <a href="http://h5cpp.org/">H5CPP</a>)</li>
<li>He also created a nice <a href="https://github.com/steven-varga/h5rnd">random HDF5 file generator/tester</a> (= 'Prüfer' in
German)</li>
</ul></li>
</ul>
</div>
</li>

<li><a id="orgb128676"></a>Steven's solution (excerpt)<br />
<div class="outline-text-4" id="text-orgb128676">
<p>
The full example can be downloaded from <a href="https://github.com/steven-varga/HDFGroup-mailinglist/tree/master/object-copy-2021-feb-18">here</a>.
</p>

<p>
<b><b>Basic idea:</b></b> Visit all objects in the source via <code>H5Ovisit</code> and invoke
<code>H5Ocopy</code> in the callback.
</p>

<div class="org-src-container">
<pre class="src src-C++"><span class="linenr"> 1: </span>
<span class="linenr"> 2: </span><span style="color: #808080;">#include</span> <span style="color: #008000;">"argparse.h"</span>
<span class="linenr"> 3: </span><span style="color: #808080;">#include</span> <span style="color: #008000;">&lt;h5cpp/all&gt;</span>
<span class="linenr"> 4: </span><span style="color: #808080;">#include</span> <span style="color: #008000;">&lt;string&gt;</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #6434A3;">herr_t</span> <span style="color: #006699;">ocpy_callback</span>(<span style="color: #6434A3;">hid_t</span> <span style="color: #BA36A5;">src</span>, <span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span> *<span style="color: #BA36A5;">name</span>, <span style="color: #0000FF;">const</span> <span style="color: #6434A3;">H5O_info_t</span> *<span style="color: #BA36A5;">info</span>,
<span class="linenr"> 7: </span>                     <span style="color: #6434A3;">void</span> *<span style="color: #BA36A5;">dst_</span>) {
<span class="linenr"> 8: </span>  <span style="color: #6434A3;">hid_t</span>* <span style="color: #BA36A5;">dst</span> = <span style="color: #0000FF;">static_cast</span>&lt;<span style="color: #6434A3;">hid_t</span>*&gt;(dst_);
<span class="linenr"> 9: </span>  <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">err</span> = 0;
<span class="linenr">10: </span>  <span style="color: #0000FF;">switch</span>( info-&gt;type ){
<span class="linenr">11: </span>  <span style="color: #0000FF;">case</span> H5O_TYPE_GROUP:
<span class="linenr">12: </span>    <span style="color: #0000FF;">if</span>(H5Lexists( *dst, name, H5P_DEFAULT) &gt;= 0)
<span class="linenr">13: </span>      err = H5Ocopy(src, name, *dst, name, H5P_DEFAULT, H5P_DEFAULT);
<span class="linenr">14: </span>    <span style="color: #0000FF;">break</span>;
<span class="linenr">15: </span>  <span style="color: #0000FF;">case</span> H5O_TYPE_DATASET:
<span class="linenr">16: </span>    err = H5Ocopy(src, name, *dst, name, H5P_DEFAULT, H5P_DEFAULT);
<span class="linenr">17: </span>    <span style="color: #0000FF;">break</span>;
<span class="linenr">18: </span>  <span style="color: #0000FF;">default</span>: <span style="color: #8D8D84;">/*</span><span style="color: #8D8D84; font-style: italic;">H5O_TYPE_NAMED_DATATYPE, H5O_TYPE_NTYPES, H5O_TYPE_UNKNOWN</span><span style="color: #8D8D84;"> */</span>
<span class="linenr">19: </span>    ; <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">nop to keep compiler happy</span>
<span class="linenr">20: </span>  }
<span class="linenr">21: </span>  <span style="color: #0000FF;">return</span> 0;
<span class="linenr">22: </span>}
<span class="linenr">23: </span>
<span class="linenr">24: </span><span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span>(<span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">argc</span>, <span style="color: #6434A3;">char</span> **<span style="color: #BA36A5;">argv</span>)
<span class="linenr">25: </span>{
<span class="linenr">26: </span>  <span style="color: #D0372D;">argparse</span>::<span style="color: #6434A3;">ArgumentParser</span> <span style="color: #BA36A5;">arg</span>(<span style="color: #008000;">"ocpy"</span>, <span style="color: #008000;">"0.0.1"</span>);
<span class="linenr">27: </span>  arg.add_argument(<span style="color: #008000;">"-i"</span>, <span style="color: #008000;">"--input"</span>)
<span class="linenr">28: </span>    .required().help(<span style="color: #008000;">"path to input hdf5 file"</span>);
<span class="linenr">29: </span>  arg.add_argument(<span style="color: #008000;">"-s"</span>, <span style="color: #008000;">"--source"</span>)
<span class="linenr">30: </span>    .default_value(<span style="color: #D0372D;">std</span>::string(<span style="color: #008000;">"/"</span>))
<span class="linenr">31: </span>    .help(<span style="color: #008000;">"path to group within hdf5 container"</span>);
<span class="linenr">32: </span>  arg.add_argument(<span style="color: #008000;">"-o"</span>, <span style="color: #008000;">"--output"</span>).required()
<span class="linenr">33: </span>    .help(<span style="color: #008000;">"the new hdf5 will be created/or opened rw"</span>);
<span class="linenr">34: </span>  arg.add_argument(<span style="color: #008000;">"-d"</span>, <span style="color: #008000;">"--destination"</span>)
<span class="linenr">35: </span>    .default_value(<span style="color: #D0372D;">std</span>::string(<span style="color: #008000;">"/"</span>))
<span class="linenr">36: </span>    .help(<span style="color: #008000;">"target group"</span>);
<span class="linenr">37: </span>
<span class="linenr">38: </span>  <span style="color: #D0372D;">std</span>::<span style="color: #6434A3;">string</span> <span style="color: #BA36A5;">input</span>, <span style="color: #BA36A5;">output</span>, <span style="color: #BA36A5;">source</span>, <span style="color: #BA36A5;">destination</span>;
<span class="linenr">39: </span>  <span style="color: #0000FF;">try</span> {
<span class="linenr">40: </span>    arg.parse_args(argc, argv);
<span class="linenr">41: </span>    input = arg.get&lt;<span style="color: #D0372D;">std</span>::<span style="color: #6434A3;">string</span>&gt;(<span style="color: #008000;">"--input"</span>);
<span class="linenr">42: </span>    output = arg.get&lt;<span style="color: #D0372D;">std</span>::<span style="color: #6434A3;">string</span>&gt;(<span style="color: #008000;">"--output"</span>);
<span class="linenr">43: </span>    source = arg.get&lt;<span style="color: #D0372D;">std</span>::<span style="color: #6434A3;">string</span>&gt;(<span style="color: #008000;">"--source"</span>);
<span class="linenr">44: </span>    destination = arg.get&lt;<span style="color: #D0372D;">std</span>::<span style="color: #6434A3;">string</span>&gt;(<span style="color: #008000;">"--destination"</span>);
<span class="linenr">45: </span>
<span class="linenr">46: </span>    <span style="color: #D0372D;">h5</span>::<span style="color: #6434A3;">fd_t</span> <span style="color: #BA36A5;">fd_i</span> = <span style="color: #D0372D;">h5</span>::open(input, H5F_ACC_RDONLY);
<span class="linenr">47: </span>    <span style="color: #D0372D;">h5</span>::<span style="color: #6434A3;">fd_t</span> <span style="color: #BA36A5;">fd_o</span> = <span style="color: #D0372D;">h5</span>::create(output, H5F_ACC_TRUNC);
<span class="linenr">48: </span>    <span style="color: #D0372D;">h5</span>::<span style="color: #6434A3;">gr_t</span> <span style="color: #BA36A5;">dgr</span>{H5I_UNINIT}, <span style="color: #BA36A5;">sgr</span> = <span style="color: #D0372D;">h5</span>::gr_t{H5Gopen(fd_i, source.data(),
<span class="linenr">49: </span>                                                     H5P_DEFAULT)};
<span class="linenr">50: </span>    <span style="color: #D0372D;">h5</span>::mute();
<span class="linenr">51: </span>    <span style="color: #0000FF;">if</span>( destination != <span style="color: #008000;">"/"</span> ){
<span class="linenr">52: </span>      <span style="color: #6434A3;">char</span> * <span style="color: #BA36A5;">gname</span> = destination.data();
<span class="linenr">53: </span>      dgr = H5Lexists(fd_o, gname, H5P_DEFAULT) &gt;= 0 ?
<span class="linenr">54: </span>        <span style="color: #D0372D;">h5</span>::gr_t{H5Gcreate(fd_o, gname, H5P_DEFAULT, H5P_DEFAULT,
<span class="linenr">55: </span>                           H5P_DEFAULT)}
<span class="linenr">56: </span>        : <span style="color: #D0372D;">h5</span>::gr_t{H5Gopen(fd_i, gname, H5P_DEFAULT)};
<span class="linenr">57: </span>      H5Ovisit(sgr, H5_INDEX_CRT_ORDER, H5_ITER_NATIVE, ocpy_callback, &amp;dgr );
<span class="linenr">58: </span>    } <span style="color: #0000FF;">else</span>
<span class="linenr">59: </span>      H5Ovisit(sgr, H5_INDEX_CRT_ORDER, H5_ITER_NATIVE, ocpy_callback, &amp;fd_o);
<span class="linenr">60: </span>    <span style="color: #D0372D;">h5</span>::unmute();
<span class="linenr">61: </span>  } <span style="color: #0000FF;">catch</span> ( <span style="color: #0000FF;">const</span> <span style="color: #D0372D;">h5</span>::<span style="color: #D0372D;">error</span>::<span style="color: #6434A3;">any</span>&amp; <span style="color: #BA36A5;">e</span> ) {
<span class="linenr">62: </span>    <span style="color: #D0372D;">std</span>::cerr &lt;&lt; e.what() &lt;&lt; <span style="color: #D0372D;">std</span>::endl;
<span class="linenr">63: </span>    <span style="color: #D0372D;">std</span>::cout &lt;&lt; arg;
<span class="linenr">64: </span>  }
<span class="linenr">65: </span>  <span style="color: #0000FF;">return</span> 0;
<span class="linenr">66: </span>}
<span class="linenr">67: </span>
</pre>
</div>
</div>
</li>

<li><a id="orgd4c2d75"></a>Parting thoughts<br />
<div class="outline-text-4" id="text-orgd4c2d75">
<ul class="org-ul">
<li>This is can be tricky business depending on how selective you want to be</li>
<li><code>H5Ovisit</code> visits <i>objects</i> and does not account for dangling links, etc.</li>
<li><code>H5Ocopy</code>'s behavior is highly customizable. Check the options &amp; play w/
<code>h5copy</code> to see the effect!</li>
</ul>
</div>
</li>

<li><a id="org79e3184"></a>More Questions<br />
<ul class="org-ul">
<li><a id="orge851a0e"></a>Question 1<br />
<div class="outline-text-5" id="text-orge851a0e">
<blockquote>
<p>
I have an unrelated question. I have 7,000 HDF5 files, each 500 MB long. When I
use them, should I open them selectively, when I need them, or is it
advantageous to make one big file, or to open virtual files? I am interested in
the speed of the different approaches.
</p>
</blockquote>

<ul class="org-ul">
<li>40 GbE connectivity</li>
<li>10 contiguously laid out Datasets per file =&gt; ~50 MB per dataset</li>
<li>Always reading full datasets</li>
<li><b><b>Considerations:</b></b>
<ul class="org-ul">
<li>If you have the RAM and use all data in an "epoch" just read whole files and
use <a href="https://support.hdfgroup.org/HDF5/doc/Advanced/FileImageOperations/HDF5FileImageOperations.pdf">HDF5 file images</a> for "in-memory I/O."</li>
<li>You could maintain an index file <i>I</i> which contains external links (one for
each of the 7,000 files), and a dataset which for each external file and
dataset contains the offset of the dataset in the file. You would keep <i>I</i>
(small!) in memory and, for each dataset request, read the ~50MB directly
w/o the HDF5 library. This assumes that no datatype conversion is necessary
and you have no trouble interpreting the bytes.</li>
<li>A variation of the previous approach would be for the stub-file to contain
HDF5 <a href="https://www.star.nesdis.noaa.gov/jpss/documents/HDF5_Tutorial_201509/2-3-Working%20with%20collections%20of%20HDF5%20files.pptx.pdf"><i>virtual datasets</i></a>, datasets stitched together from other
datasets. This would we a good option, if you wanted to simplify your
application code and make everything appear as a single large HDF5
file. It'd be important though to have that (small) stub-file on the clients
in memory to not incur a high latency penalty.</li>
<li>Both approaches can be easily parallelized, assuming read-only access. If
there are writers involved, it's still doable, but additional considerations
apply.</li>
</ul></li>
</ul>

<blockquote>
<p>
Another question: what is the recommended way to combine Python with C++ with
C++ reading in and working on large hdf5 files that require a lot of speed.
</p>
</blockquote>

<ul class="org-ul">
<li>To be honest, we ran out of time and I (GH) didn't fully grasp the question.</li>
<li>Steven said something about Julia</li>
<li>Henric uses Boost Python.  What about Cython?</li>
<li><p>
What's the access pattern?
</p>

<p>
<b><b>Let's continue the discussion on the forum or come back next week!</b></b>
</p></li>
</ul>
</div>
</li>
</ul>
</li>
</ul>
</div>

<div id="outline-container-org89f253b" class="outline-3">
<h3 id="org89f253b">Last week's highlights</h3>
<div class="outline-text-3" id="text-org89f253b">
</div>
<ul class="org-ul">
<li><a id="org765d750"></a>Forum<br />
<div class="outline-text-4" id="text-org765d750">
<ul class="org-ul">
<li><a href="https://forum.hdfgroup.org/t/possible-bug-with-hyperslab-selection-in-1-10-7/8164">Hyperslab selection bug confirmed</a></li>
<li><a href="https://forum.hdfgroup.org/t/write-data-to-variable-length-string-attribute/8101">Write data to variable length string attribute</a> bug is a feature <code>;-)</code></li>
<li><a href="https://forum.hdfgroup.org/t/creating-a-dataset-through-external-link-does-not-allow-hdf5view-to-see-resulting-dataset-from-root-file/8148">Possible bug in HDFView</a>
<ul class="org-ul">
<li>The <a href="https://en.wikipedia.org/wiki/Minimal_working_example">MWE</a> checks out and it looks more and more like a bug in HDFView</li>
</ul></li>
</ul>
</div>
</li>
</ul>
</div>

<div id="outline-container-org17bbc8f" class="outline-3">
<h3 id="org17bbc8f">Appendix</h3>
<div class="outline-text-3" id="text-org17bbc8f">
</div>
<ul class="org-ul">
<li><a id="org7d2df01"></a>The <code>h5copy</code> command line tool<br />
<div class="outline-text-4" id="text-org7d2df01">
<pre class="example" id="org0d32277">
gerd@guix ~$ h5copy

usage: h5copy [OPTIONS] [OBJECTS...]
   OBJECTS
      -i, --input        input file name
      -o, --output       output file name
      -s, --source       source object name
      -d, --destination  destination object name
   OPTIONS
      -h, --help         Print a usage message and exit
      -p, --parents      No error if existing, make parent groups as needed
      -v, --verbose      Print information about OBJECTS and OPTIONS
      -V, --version      Print version number and exit
      --enable-error-stack
                  Prints messages from the HDF5 error stack as they occur.
      -f, --flag         Flag type

      Flag type is one of the following strings:

      shallow     Copy only immediate members for groups

      soft        Expand soft links into new objects

      ext         Expand external links into new objects

      ref         Copy references and any referenced objects, i.e., objects
                  that the references point to.
                    Referenced objects are copied in addition to the objects
                  specified on the command line and reference datasets are
                  populated with correct reference values. Copies of referenced
                  datasets outside the copy range specified on the command line
                  will normally have a different name from the original.
                    (Default:Without this option, reference value(s) in any
                  reference datasets are set to NULL and referenced objects are
                  not copied unless they are otherwise within the copy range
                  specified on the command line.)

      noattr      Copy object without copying attributes

      allflags    Switches all flags from the default to the non-default setting

      These flag types correspond to the following API symbols

      H5O_COPY_SHALLOW_HIERARCHY_FLAG
      H5O_COPY_EXPAND_SOFT_LINK_FLAG
      H5O_COPY_EXPAND_EXT_LINK_FLAG
      H5O_COPY_EXPAND_REFERENCE_FLAG
      H5O_COPY_WITHOUT_ATTR_FLAG
      H5O_COPY_ALL
</pre>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgdce8002" class="outline-2">
<h2 id="orgdce8002">Clinic 2021-02-16</h2>
<div class="outline-text-2" id="text-orgdce8002">
</div>
<div id="outline-container-org55af126" class="outline-3">
<h3 id="org55af126">Your questions</h3>
</div>
<div id="outline-container-org21740da" class="outline-3">
<h3 id="org21740da">Last week's highlights</h3>
<div class="outline-text-3" id="text-org21740da">
</div>
<ul class="org-ul">
<li><a id="org6244939"></a>Events<br />
<div class="outline-text-4" id="text-org6244939">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=7ZYZKB7DNUg">Webinar: <i>Learn about data virtualization with HDF5-UDF and how it can
streamline your work</i></a></li>
<li><a href="https://www.youtube.com/watch?v=g5h_YlvI9Aw">Recording of last week's clinic</a></li>
</ul>
</div>
</li>
<li><a id="org78b1be8"></a>Forum<br />
<div class="outline-text-4" id="text-org78b1be8">
<ul class="org-ul">
<li><a href="https://forum.hdfgroup.org/t/hdfql-2-3-0-release-with-excel-import-export-support/8132">Release of HDFql 2.3.0</a>
<ul class="org-ul">
<li>Excel import and export (no Excel or OLE dependency!)</li>
</ul></li>
<li><a href="https://forum.hdfgroup.org/t/creating-a-dataset-through-external-link-does-not-allow-hdf5view-to-see-resulting-dataset-from-root-file/8148">Possible bug in HDFView</a>
<ul class="org-ul">
<li>Based on the description, it appears that external links are not properly
traversed</li>
<li>Waiting for <a href="https://en.wikipedia.org/wiki/Minimal_working_example">MWE</a></li>
</ul></li>
<li><a href="https://forum.hdfgroup.org/t/possible-bug-with-hyperslab-selection-in-1-10-7/8164">Possible hyperslab selection bug in 1.10.7</a>
<ul class="org-ul">
<li>It appears that <code>H5S_SELECT_OR</code> is no longer "commutative", i.e., <code>H5Dread</code>
with <code>SelA OR SelB</code> works, but not <code>SelB OR SelA</code></li>
<li>Wasn't there in 1.10.6</li>
</ul></li>
</ul>
</div>
</li>
</ul>
</div>
<div id="outline-container-org939a8bb" class="outline-3">
<h3 id="org939a8bb">Notes</h3>
<div class="outline-text-3" id="text-org939a8bb">
</div>
<ul class="org-ul">
<li><a id="org3eb9e9e"></a>What (if any) are the ACID properties of HDF5 operations?<br />
<ul class="org-ul">
<li><a id="orgd64ade9"></a>Split-state<br />
<div class="outline-text-5" id="text-orgd64ade9">
<p>
The state of an open (for RW) HDF5 file is <i>split</i> between RAM and persistent
storage. Often the partial states will be out of sync. In the event of a
"catastrophic" failure (power outage, application crash, system crash), it is
impossible to predict what the partial state on disk will be.
</p>


<div id="org09e202d" class="figure">
<p><img src="hdf5-file-state.png" alt="hdf5-file-state.png" />
</p>
</div>
</div>
</li>

<li><a id="org714e83e"></a>Non-transactional<br />
<div class="outline-text-5" id="text-org714e83e">
<p>
The main reason why it is impossible to predict the outcome is that HDF5
operations are non-transactional. By 'transaction' I mean a collection of
operations (and the effects of their execution) on the physical and abstract
application state. In particular, there are no concepts of beginning a
transaction, a commit, or a roll-back. Since they are not transactional, it is
not straightforward to speak about the ACID properties of HDF5 operations.
</p>
</div>
</li>

<li><a id="orgc90f339"></a>File system facilities<br />
<div class="outline-text-5" id="text-orgc90f339">
<p>
People sometimes speak about ACID properties with respect to file system
operations. Although the HDF5 library relies on file system operations for the
implementation of HDF5 operations, the correspondence is not as direct as
might wish. For example, what appears as a single HDF5 operation to the user
often includes multiple file system operations. Several file system operations
have a certain property only at the level of a single operation, but not
multiple operations combined.
</p>
</div>
</li>

<li><a id="orgbd71f3a"></a>ACID<br />
<div class="outline-text-5" id="text-orgbd71f3a">
<dl class="org-dl">
<dt>Atomicity</dt><dd>All changes to an HDF5 file's state must complete or fail as a
whole unit.
<ul class="org-ul">
<li>Supported in HDF5? <b><b>No.</b></b></li>
<li>Some file systems only support single op. atomicity, if at all.</li>
<li>A lot of HDF5 operations are <i>in-place</i>; mixed success -&gt; impossible to
recover</li>
</ul></dd>
<dt>Consistency</dt><dd>An operation is a correct transformation of the HDF5 file's
state.
<ul class="org-ul">
<li>Supported in HDF5? <b><b>Yes and No</b></b></li>
<li>Depends on one's definition of HDF5 file/object integrity constraints</li>
<li>Assuming we are dealing with a correct program</li>
<li>Special case w/ multiple processes: Single Writer Multiple Reader</li>
</ul></dd>
<dt>Isolation (serialization)</dt><dd>Even though operations execute concurrently, it</dd>
</dl>
<p>
appears to each operation, OP, that others executed either before OP or after
  OP, but not both.
</p>
<ul class="org-ul">
<li>Supported in HDF5? <b><b>No.</b></b></li>
<li>Depends on concurrency scenario and requires special configuration (e.g.,
MT, MPI).</li>
<li>Time-of-check-time-of-use vulnerability</li>
</ul>
<dl class="org-dl">
<dt>Durability</dt><dd>Once an operation completes successfully, it's changes to the
file's state survive failure.
<ul class="org-ul">
<li>Supported in HDF5? <b><b>No.</b></b></li>
<li>"Split brain"</li>
<li>No transaction log</li>
</ul></dd>
</dl>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgb940ca9" class="outline-2">
<h2 id="orgb940ca9">Clinic 2021-02-09</h2>
<div class="outline-text-2" id="text-orgb940ca9">
<p>
<b><b>THIS MEETING IS BEING RECORDED</b></b> and the recording will be available on The
HDF Group's <a href="https://www.youtube.com/channel/UCRhtsIZquL3r-zH-R-r9-tQ">YouTube channel</a>. Remember to subscribe!
</p>
</div>

<div id="outline-container-org23ceace" class="outline-3">
<h3 id="org23ceace">Goal(s)</h3>
</div>
<div id="outline-container-orgcff77fb" class="outline-3">
<h3 id="orgcff77fb">This is a meeting dedicated to <i>your</i> questions.</h3>
</div>
<div id="outline-container-orgaeaa3a2" class="outline-3">
<h3 id="orgaeaa3a2">In the unlikely event there aren't any</h3>
<div class="outline-text-3" id="text-orgaeaa3a2">
<p>
We have a few prepared topics (forum posts, announcements, etc.)
</p>
</div>
</div>
<div id="outline-container-orgd7b1f27" class="outline-3">
<h3 id="orgd7b1f27">Sometimes life deals you an HDF5 file</h3>
<div class="outline-text-3" id="text-orgd7b1f27">
<p>
No question is too small. We are here to learn. All of us.
</p>
</div>
</div>

<div id="outline-container-orgd90e9a7" class="outline-3">
<h3 id="orgd90e9a7">Meeting Etiquette</h3>
</div>
<div id="outline-container-orgb49a30a" class="outline-3">
<h3 id="orgb49a30a">Be social, turn on your camera (if you've got one)</h3>
<div class="outline-text-3" id="text-orgb49a30a">
<p>
Talking to black boxes isn't fun.
</p>
</div>
</div>

<div id="outline-container-org8fb40ee" class="outline-3">
<h3 id="org8fb40ee">Raise your hand to signal a contribution (question, comment)</h3>
<div class="outline-text-3" id="text-org8fb40ee">
<p>
Mute yourself while others are speaking, be ready to participate.
</p>
</div>
</div>

<div id="outline-container-org6fc31e4" class="outline-3">
<h3 id="org6fc31e4">Be mindful of your "airtime"</h3>
<div class="outline-text-3" id="text-org6fc31e4">
<p>
We want to cover as many of your topics as possible. Be fair to others.
</p>
</div>
</div>

<div id="outline-container-org579c9d2" class="outline-3">
<h3 id="org579c9d2">Introduce yourself</h3>
<div class="outline-text-3" id="text-org579c9d2">
<ol class="org-ol">
<li>Your Name</li>
<li>Your affiliation/organization/group</li>
<li>One reason why you are here today</li>
</ol>
</div>
</div>

<div id="outline-container-org54d360b" class="outline-3">
<h3 id="org54d360b">Use the shared Google doc for questions and code snippets</h3>
<div class="outline-text-3" id="text-org54d360b">
<p>
The <a href="https://docs.google.com/document/d/17j7MsAdNdCLxxWA_PtXv3jTgWDTqOm2uTk5jHCj8zXM/edit">link</a> can be found in the chat window.
</p>
</div>
</div>

<div id="outline-container-orgd2fd193" class="outline-3">
<h3 id="orgd2fd193">When the 30 min. timer runs out, this meeting is over.</h3>
<div class="outline-text-3" id="text-orgd2fd193">
<p>
Continue the discussion on the <a href="https://forum.hdfgroup.org/">HDF Forum</a> or come back next week!
</p>
</div>
</div>

<div id="outline-container-org06af423" class="outline-3">
<h3 id="org06af423">Notes</h3>
</div>
<div id="outline-container-org1865d2e" class="outline-3">
<h3 id="org1865d2e">Don't miss our next webinar about data virtualization with HDF5-UDF and how it can streamline your work</h3>
<div class="outline-text-3" id="text-org1865d2e">
<ul class="org-ul">
<li>Presented by Lucas Villa Real (IBM Research)</li>
<li>Feb 12, 2021 11:00 AM in Central Time (US and Canada)</li>
<li><a href="https://zoom.us/meeting/register/tJEsc-iqrj4iGNJirT52ttruJ1DH2uWmFV">Sign-up link</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgc741995" class="outline-3">
<h3 id="orgc741995">Bug-of-the-Week Award (my candidate)</h3>
<div class="outline-text-3" id="text-orgc741995">
<ul class="org-ul">
<li><a href="https://forum.hdfgroup.org/t/write-data-to-variable-length-string-attribute/8101">Write data to variable length string attribute</a> by Kerim Khemraev</li>
<li><a href="https://jira.hdfgroup.org/browse/HDFFV-11215">Jira issue HDFFV-11215</a></li>
<li><p>
Quick demonstration
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #808080;">#include</span> <span style="color: #008000;">"hdf5.h"</span>

<span style="color: #808080;">#include</span> <span style="color: #008000;">&lt;filesystem&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #008000;">&lt;iostream&gt;</span>
<span style="color: #808080;">#include</span> <span style="color: #008000;">&lt;string&gt;</span>

<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">H5FILE_NAME</span> <span style="color: #008000;">"Attributes.h5"</span>
<span style="color: #808080;">#define</span> <span style="color: #BA36A5;">ATTR_NAME</span>   <span style="color: #008000;">"VarLenAttr"</span>

<span style="color: #0000FF;">namespace</span> <span style="color: #D0372D;">fs</span> = <span style="color: #D0372D;">std</span>::filesystem;

<span style="color: #6434A3;">int</span> <span style="color: #006699;">main</span>(<span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">argc</span>, <span style="color: #6434A3;">char</span> *<span style="color: #BA36A5;">argv</span>[])
{
  <span style="color: #6434A3;">hid_t</span> <span style="color: #BA36A5;">file</span>, <span style="color: #BA36A5;">attr</span>;

  <span style="color: #0000FF;">auto</span> <span style="color: #BA36A5;">attr_type</span> = H5Tcopy(H5T_C_S1);
  H5Tset_size(attr_type, H5T_VARIABLE);
  H5Tset_cset(attr_type, H5T_CSET_UTF8);

  <span style="color: #0000FF;">auto</span> <span style="color: #BA36A5;">make_scalar_attr</span> = [](<span style="color: #0000FF;">auto</span>&amp; <span style="color: #BA36A5;">file</span>, <span style="color: #0000FF;">auto</span>&amp; <span style="color: #BA36A5;">attr_type</span>)
   -&gt; hid_t
  {
    <span style="color: #0000FF;">auto</span> <span style="color: #BA36A5;">attr_space</span>  = H5Screate(H5S_SCALAR);
    <span style="color: #0000FF;">auto</span> <span style="color: #BA36A5;">result</span> = H5Acreate(file, ATTR_NAME,
                            attr_type, attr_space,
                            H5P_DEFAULT, H5P_DEFAULT);
    H5Sclose(attr_space);
    <span style="color: #0000FF;">return</span> result;
  };

  <span style="color: #0000FF;">if</span>( !<span style="color: #D0372D;">fs</span>::exists(H5FILE_NAME) )
    { <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">If the file doesn't exist we create it &amp;</span>
      <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">add a root group attribute</span>
      <span style="color: #D0372D;">std</span>::cout &lt;&lt; <span style="color: #008000;">"Creating file...\n"</span>;
      file = H5Fcreate(H5FILE_NAME, H5F_ACC_TRUNC,
                      H5P_DEFAULT, H5P_DEFAULT);
      attr = make_scalar_attr(file, attr_type);
    }
  <span style="color: #0000FF;">else</span>
    { <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">File exists: we either delete the attribute and</span>
      <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">re-create it, or we just re-write it.</span>
      <span style="color: #D0372D;">std</span>::cout &lt;&lt; <span style="color: #008000;">"Opening file...\n"</span>;
      file = H5Fopen(H5FILE_NAME, H5F_ACC_RDWR, H5P_DEFAULT);

<span style="color: #808080;">#if</span><span style="color: #808080;">n</span><span style="color: #808080;">def</span> REWRITE_ONLY
      H5Adelete(file, ATTR_NAME);
      attr = make_scalar_attr(file, attr_type);
<span style="color: #808080;">#else</span>
      attr = H5Aopen(file, ATTR_NAME, H5P_DEFAULT);
<span style="color: #808080;">#endif</span>
    }

  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Write or re-write the attribute</span>
  <span style="color: #0000FF;">const</span> <span style="color: #6434A3;">char</span>* <span style="color: #BA36A5;">data</span>[1] = { <span style="color: #008000;">"Let it be &#955;!"</span> };
  H5Awrite(attr, attr_type, data);

  <span style="color: #6434A3;">hsize_t</span> <span style="color: #BA36A5;">size</span>;
  H5Fget_filesize(file, &amp;size);
  <span style="color: #D0372D;">std</span>::cout &lt;&lt; <span style="color: #008000;">"File size: "</span> &lt;&lt; size &lt;&lt; <span style="color: #008000;">" bytes\n"</span>;

  H5Tclose(attr_type);
  H5Aclose(attr);
  H5Fclose(file);
}
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org3427e43" class="outline-3">
<h3 id="org3427e43">Documentation update</h3>
<div class="outline-text-3" id="text-org3427e43">
<ul class="org-ul">
<li>Doxygen-based RM</li>
<li>Remaining: a few <code>H5P</code>  calls and <code>H5E</code></li>
<li>Current version: <a href="https://hdf5.io/develop/modules.html">https://hdf5.io/develop/modules.html</a></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: gerdheber</p>
<p class="date">Created: 2021-03-02 Tue 13:32</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
